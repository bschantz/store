{"version":3,"file":"ngxs-devtools-plugin.umd.js","sources":["../../../../packages/devtools-plugin/src/symbols.ts","../../../../packages/devtools-plugin/src/devtools.plugin.ts","../../../../packages/devtools-plugin/src/devtools.module.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\n/**\n * Interface for the redux-devtools-extension API.\n */\nexport interface NgxsDevtoolsExtension {\n  init(state: any): void;\n  send(action: any, state?: any): void;\n  subscribe(fn: (message: NgxsDevtoolsAction) => void): Subscription;\n}\n\nexport interface NgxsDevtoolsAction {\n  type: string;\n  payload: any;\n  state: any;\n  id: number;\n  source: string;\n}\n\nexport interface NgxsDevtoolsOptions {\n  /**\n   * The name of the extension\n   */\n  name?: string;\n\n  /**\n   * Whether the dev tools is enabled or note. Useful for setting during production.\n   */\n  disabled?: boolean;\n\n  /**\n   * Max number of entiries to keep.\n   */\n  maxAge?: number;\n\n  /**\n   * Reformat actions before sending to dev tools\n   */\n  actionSanitizer?: (action: any) => void;\n\n  /**\n   * Reformat state before sending to devtools\n   */\n  stateSanitizer?: (state: any) => void;\n}\n\nexport const NGXS_DEVTOOLS_OPTIONS = new InjectionToken('NGXS_DEVTOOLS_OPTIONS');\n","import { Inject, Injectable, Injector } from '@angular/core';\nimport { getActionTypeFromInstance, NgxsNextPluginFn, NgxsPlugin, Store } from '@ngxs/store';\nimport { tap, catchError } from 'rxjs/operators';\n\nimport {\n  NGXS_DEVTOOLS_OPTIONS,\n  NgxsDevtoolsAction,\n  NgxsDevtoolsExtension,\n  NgxsDevtoolsOptions\n} from './symbols';\n\n/**\n * Adds support for the Redux Devtools extension:\n * http://extension.remotedev.io/\n */\n@Injectable()\nexport class NgxsReduxDevtoolsPlugin implements NgxsPlugin {\n  private readonly devtoolsExtension: NgxsDevtoolsExtension | null = null;\n  private readonly windowObj: any = typeof window !== 'undefined' ? window : {};\n\n  constructor(\n    @Inject(NGXS_DEVTOOLS_OPTIONS) private _options: NgxsDevtoolsOptions,\n    private _injector: Injector\n  ) {\n    const globalDevtools =\n      this.windowObj['__REDUX_DEVTOOLS_EXTENSION__'] || this.windowObj['devToolsExtension'];\n    if (globalDevtools) {\n      this.devtoolsExtension = globalDevtools.connect(_options) as NgxsDevtoolsExtension;\n      this.devtoolsExtension.subscribe(a => this.dispatched(a));\n    }\n  }\n\n  /**\n   * Lazy get the store for circular dependency issues\n   */\n  private get store(): Store {\n    return this._injector.get<Store>(Store);\n  }\n\n  /**\n   * Middleware handle function\n   */\n  handle(state: any, action: any, next: NgxsNextPluginFn) {\n    const isDisabled = this._options && this._options.disabled;\n    if (!this.devtoolsExtension || isDisabled) {\n      return next(state, action);\n    }\n\n    return next(state, action).pipe(\n      catchError(error => {\n        const newState = this.store.snapshot();\n        this.sendToDevTools(state, action, newState);\n        throw error;\n      }),\n      tap(newState => {\n        this.sendToDevTools(state, action, newState);\n      })\n    );\n  }\n\n  private sendToDevTools(state: any, action: any, newState: any) {\n    const type = getActionTypeFromInstance(action);\n    // if init action, send initial state to dev tools\n    const isInitAction = type === '@@INIT';\n    if (isInitAction) {\n      this.devtoolsExtension!.init(state);\n    } else {\n      this.devtoolsExtension!.send({ ...action, action: null, type }, newState);\n    }\n  }\n\n  /**\n   * Handle the action from the dev tools subscription\n   */\n  dispatched(action: NgxsDevtoolsAction) {\n    if (action.type === 'DISPATCH') {\n      if (\n        action.payload.type === 'JUMP_TO_ACTION' ||\n        action.payload.type === 'JUMP_TO_STATE'\n      ) {\n        const prevState = JSON.parse(action.state);\n        this.store.reset(prevState);\n      } else if (action.payload.type === 'TOGGLE_ACTION') {\n        console.warn('Skip is not supported at this time.');\n      } else if (action.payload.type === 'IMPORT_STATE') {\n        const {\n          actionsById,\n          computedStates,\n          currentStateIndex\n        } = action.payload.nextLiftedState;\n        this.devtoolsExtension!.init(computedStates[0].state);\n        Object.keys(actionsById)\n          .filter(actionId => actionId !== '0')\n          .forEach(actionId =>\n            this.devtoolsExtension!.send(actionsById[actionId], computedStates[actionId].state)\n          );\n        this.store.reset(computedStates[currentStateIndex].state);\n      }\n    } else if (action.type === 'ACTION') {\n      const actionPayload = JSON.parse(action.payload);\n      this.store.dispatch(actionPayload);\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders, InjectionToken } from '@angular/core';\nimport { NGXS_PLUGINS } from '@ngxs/store';\n\nimport { NgxsDevtoolsOptions, NGXS_DEVTOOLS_OPTIONS } from './symbols';\nimport { NgxsReduxDevtoolsPlugin } from './devtools.plugin';\n\nexport function devtoolsOptionsFactory(options: NgxsDevtoolsOptions) {\n  return {\n    name: 'NGXS',\n    ...options\n  };\n}\n\nexport const USER_OPTIONS = new InjectionToken('USER_OPTIONS');\n\n@NgModule()\nexport class NgxsReduxDevtoolsPluginModule {\n  static forRoot(\n    options?: NgxsDevtoolsOptions\n  ): ModuleWithProviders<NgxsReduxDevtoolsPluginModule> {\n    return {\n      ngModule: NgxsReduxDevtoolsPluginModule,\n      providers: [\n        {\n          provide: NGXS_PLUGINS,\n          useClass: NgxsReduxDevtoolsPlugin,\n          multi: true\n        },\n        {\n          provide: USER_OPTIONS,\n          useValue: options\n        },\n        {\n          provide: NGXS_DEVTOOLS_OPTIONS,\n          useFactory: devtoolsOptionsFactory,\n          deps: [USER_OPTIONS]\n        }\n      ]\n    };\n  }\n}\n"],"names":["InjectionToken","Store","catchError","tap","getActionTypeFromInstance","Injectable","Inject","Injector","NGXS_PLUGINS","NgModule"],"mappings":"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"}