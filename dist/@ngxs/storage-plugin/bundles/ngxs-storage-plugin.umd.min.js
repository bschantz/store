!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@ngxs/store"),require("@angular/common"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngxs/storage-plugin",["exports","@angular/core","@ngxs/store","@angular/common","rxjs/operators"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).ngxs=e.ngxs||{},e.ngxs["storage-plugin"]={}),e.ng.core,e["ngxs-store"],e.ng.common,e.rxjs.operators)}(this,(function(e,r,t,n,o){"use strict";var i=new r.InjectionToken("NGXS_STORAGE_PLUGIN_OPTION"),a=new r.InjectionToken("STORAGE_ENGINE");function s(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e){var r;return void 0!==e&&e.key&&(e.key=(r=e.key,Array.isArray(r)||(r=[r]),r.map((function(e){return"string"==typeof e?e:e instanceof t.StateToken?e.getName():e.NGXS_OPTIONS_META.name})))),Object.assign({key:["@@STATE"],storage:0,serialize:JSON.stringify,deserialize:JSON.parse,beforeSerialize:function(e){return e},afterDeserialize:function(e){return e}},e)}function u(e,r){return n.isPlatformServer(r)?null:0===e.storage?localStorage:1===e.storage?sessionStorage:null}var c=function(){function e(e,r,t){this._options=e,this._engine=r,this._platformId=t}return e.prototype.handle=function(e,r,i){var a,l,u=this;if(n.isPlatformServer(this._platformId)&&null===this._engine)return i(e,r);var c=this._options.key,f=t.actionMatcher(r),g=f(t.InitState)||f(t.UpdateState),p=!1;if(g){var d=function(r){var n="@@STATE"===r,o=y._engine.getItem(r);if("undefined"!==o&&null!=o){try{var i=y._options.deserialize(o);o=y._options.afterDeserialize(i,r)}catch(e){console.error("Error ocurred while deserializing the store value, falling back to empty object."),o={}}y._options.migrations&&y._options.migrations.forEach((function(e){var i=e.version===t.getValue(o,e.versionKey||"version"),a=!e.key&&n||e.key===r;i&&a&&(o=e.migrate(o),p=!0)})),e=n?Object.assign(Object.assign({},e),o):t.setValue(e,r,o)}},y=this;try{for(var v=s(c),S=v.next();!S.done;S=v.next()){d(S.value)}}catch(e){a={error:e}}finally{try{S&&!S.done&&(l=v.return)&&l.call(v)}finally{if(a)throw a.error}}}return i(e,r).pipe(o.tap((function(e){var r,n;if(!g||g&&p)try{for(var o=s(c),i=o.next();!i.done;i=o.next()){var a=i.value,l=e;"@@STATE"!==a&&(l=t.getValue(e,a));try{var f=u._options.beforeSerialize(l,a);u._engine.setItem(a,u._options.serialize(f))}catch(e){console.error("Error ocurred while serializing the store value, value not updated.")}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}})))},e}();c.decorators=[{type:r.Injectable}],c.ctorParameters=function(){return[{type:void 0,decorators:[{type:r.Inject,args:[i]}]},{type:void 0,decorators:[{type:r.Inject,args:[a]}]},{type:String,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]}]};var f=new r.InjectionToken("USER_OPTIONS"),g=function(){function e(){}return e.forRoot=function(n){return{ngModule:e,providers:[{provide:t.NGXS_PLUGINS,useClass:c,multi:!0},{provide:f,useValue:n},{provide:i,useFactory:l,deps:[f]},{provide:a,useFactory:u,deps:[i,r.PLATFORM_ID]}]}},e}();g.decorators=[{type:r.NgModule}],e.NGXS_STORAGE_PLUGIN_OPTIONS=i,e.NgxsStoragePlugin=c,e.NgxsStoragePluginModule=g,e.STORAGE_ENGINE=a,e.ɵa=f,e.ɵb=l,e.ɵc=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngxs-storage-plugin.umd.min.js.map