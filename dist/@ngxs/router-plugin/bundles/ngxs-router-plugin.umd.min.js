!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngxs/store"),require("@angular/router"),require("@angular/common"),require("@ngxs/store/internals"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngxs/router-plugin",["exports","@angular/core","@ngxs/store","@angular/router","@angular/common","@ngxs/store/internals","rxjs/operators"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).ngxs=t.ngxs||{},t.ngxs["router-plugin"]={}),t.ng.core,t["ngxs-store"],t.ng.router,t.ng.common,t["ngxs-store-internals"],t.rxjs.operators)}(this,(function(t,e,r,o,n,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function s(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var c=function(){function t(t,e,r){this.path=t,this.queryParams=e,this.extras=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] Navigate"},enumerable:!1,configurable:!0}),t}();var l=function(){function t(t,e,r){void 0===r&&(r="none"),this.routerState=t,this.event=e,this.trigger=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterNavigation"},enumerable:!1,configurable:!0}),t}();var g=function(){function t(t,e,r,o){void 0===o&&(o="none"),this.routerState=t,this.storeState=e,this.event=r,this.trigger=o}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterCancel"},enumerable:!1,configurable:!0}),t}();var p=function(){function t(t,e,r,o){void 0===o&&(o="none"),this.routerState=t,this.storeState=e,this.event=r,this.trigger=o}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterError"},enumerable:!1,configurable:!0}),t}();var h=function(){function t(t,e,r){void 0===r&&(r="none"),this.routerState=t,this.event=e,this.trigger=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterDataResolved"},enumerable:!1,configurable:!0}),t}();var f=function(){};var d,R=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map((function(t){return e.serializeRoute(t)}));return{url:t.url,params:t.params,queryParams:t.queryParams,fragment:t.fragment,data:t.data,outlet:t.outlet,component:null,routeConfig:null,root:null,parent:null,firstChild:r[0],children:r,pathFromRoot:null,paramMap:t.paramMap,queryParamMap:t.queryParamMap,toString:t.toString}},t}();t.RouterState=d=function(){function t(t,e,r,o,n,i,a){this._store=t,this._router=e,this._serializer=r,this._ngZone=o,this._urlSerializer=n,this._locationStrategy=i,this._location=a,this._trigger="none",this._routerState=null,this._storeState=null,this._lastRoutesRecognized=null,this.setUpStoreListener(),this.setUpRouterEventsListener(),this.checkInitialNavigationOnce()}return t.state=function(t){return t&&t.state},t.url=function(t){return t&&t.state&&t.state.url},t.prototype.navigate=function(t,e){var r=this;return this._ngZone.run((function(){return r._router.navigate(e.path,Object.assign({queryParams:e.queryParams},e.extras))}))},t.prototype.angularRouterAction=function(t,e){t.setState(Object.assign(Object.assign({},t.getState()),{trigger:e.trigger,state:e.routerState,navigationId:e.event.id}))},t.prototype.setUpStoreListener=function(){var t=this;this._store.select(d).subscribe((function(e){t.navigateIfNeeded(e)}))},t.prototype.setUpRouterEventsListener=function(){var t=this;this._router.events.subscribe((function(e){e instanceof o.NavigationStart?t.navigationStart():e instanceof o.RoutesRecognized?t._lastRoutesRecognized=e:e instanceof o.ResolveEnd?t.dispatchRouterDataResolved(e):e instanceof o.NavigationCancel?(t.dispatchRouterCancel(e),t.reset()):e instanceof o.NavigationError?(t.dispatchRouterError(e),t.reset()):e instanceof o.NavigationEnd&&(t.navigationEnd(),t.reset())}))},t.prototype.navigationStart=function(){this._routerState=this._serializer.serialize(this._router.routerState.snapshot),"none"!==this._trigger&&(this._storeState=this._store.selectSnapshot(d))},t.prototype.navigationEnd=function(){this.shouldDispatchRouterNavigation()&&this.dispatchRouterNavigation()},t.prototype.shouldDispatchRouterNavigation=function(){return!this._storeState||"store"!==this._trigger},t.prototype.navigateIfNeeded=function(t){var e=this;!this._storeState||!this._storeState.state||!t||"router"===t.trigger||this._router.url===this._storeState.state.url||(this._trigger="store",this._ngZone.run((function(){e._router.navigateByUrl(e._storeState.state.url)})))},t.prototype.dispatchRouterNavigation=function(){var t=this._serializer.serialize(this._lastRoutesRecognized.state);this.dispatchRouterAction(new l(t,new o.RoutesRecognized(this._lastRoutesRecognized.id,this._lastRoutesRecognized.url,this._lastRoutesRecognized.urlAfterRedirects,t),this._trigger))},t.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction(new g(this._routerState,this._storeState,t,this._trigger))},t.prototype.dispatchRouterError=function(t){this.dispatchRouterAction(new p(this._routerState,this._storeState,new o.NavigationError(t.id,t.url,""+t),this._trigger))},t.prototype.dispatchRouterAction=function(t){this._trigger="router";try{this._store.dispatch(t)}finally{this._trigger="none"}},t.prototype.dispatchRouterDataResolved=function(t){var e=this._serializer.serialize(t.state);this.dispatchRouterAction(new h(e,t,this._trigger))},t.prototype.reset=function(){this._trigger="none",this._storeState=null,this._routerState=null},t.prototype.checkInitialNavigationOnce=function(){var t=this;i.isAngularInTestMode()||this._router.events.pipe(a.first((function(t){return t instanceof o.RoutesRecognized}))).subscribe((function(e){var r=e.url,o=t._location.normalize(t._locationStrategy.path(!0)),n=t._urlSerializer.parse(o);t._urlSerializer.serialize(n)!==r&&t._router.navigateByUrl(o)}))},t}(),t.RouterState.decorators=[{type:e.Injectable}],t.RouterState.ctorParameters=function(){return[{type:r.Store},{type:o.Router},{type:f},{type:e.NgZone},{type:o.UrlSerializer},{type:n.LocationStrategy},{type:n.Location}]},s([r.Action(c),u("design:type",Function),u("design:paramtypes",[Object,c]),u("design:returntype",void 0)],t.RouterState.prototype,"navigate",null),s([r.Action([l,p,g,h]),u("design:type",Function),u("design:paramtypes",[Object,Object]),u("design:returntype",void 0)],t.RouterState.prototype,"angularRouterAction",null),s([r.Selector(),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],t.RouterState,"state",null),s([r.Selector(),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Object)],t.RouterState,"url",null),t.RouterState=d=s([r.State({name:"router",defaults:{state:void 0,navigationId:void 0,trigger:"none"}}),u("design:paramtypes",[r.Store,o.Router,f,e.NgZone,o.UrlSerializer,n.LocationStrategy,n.Location])],t.RouterState);var y=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:f,useClass:R}]}},t}();y.decorators=[{type:e.NgModule,args:[{imports:[r.NgxsModule.forFeature([t.RouterState])]}]}],t.DefaultRouterStateSerializer=R,t.Navigate=c,t.NgxsRouterPluginModule=y,t.RouterCancel=g,t.RouterDataResolved=h,t.RouterError=p,t.RouterNavigation=l,t.RouterStateSerializer=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngxs-router-plugin.umd.min.js.map