!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngxs/store"),require("@angular/forms"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngxs/form-plugin",["exports","@angular/core","@ngxs/store","@angular/forms","rxjs","rxjs/operators"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).ngxs=t.ngxs||{},t.ngxs["form-plugin"]={}),t.ng.core,t["ngxs-store"],t.ng.forms,t.rxjs,t.rxjs.operators)}(this,(function(t,e,r,o,n,a){"use strict";var i=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Update Form Status"},enumerable:!1,configurable:!0}),t}();var s=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Update Form Value"},enumerable:!1,configurable:!0}),t}();var u=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Update Form"},enumerable:!1,configurable:!0}),t}();var p=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Update Form Dirty"},enumerable:!1,configurable:!0}),t}();var c=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Set Form Dirty"},enumerable:!1,configurable:!0}),t}();var l=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Set Form Pristine"},enumerable:!1,configurable:!0}),t}();var d=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Update Form Errors"},enumerable:!1,configurable:!0}),t}();var f=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Set Form Disabled"},enumerable:!1,configurable:!0}),t}();var h=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Set Form Enabled"},enumerable:!1,configurable:!0}),t}();var y=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"[Forms] Reset Form"},enumerable:!1,configurable:!0}),t}();var m=function(){function t(){}return t.prototype.handle=function(t,e,o){var n=r.getActionTypeFromInstance(e),a=t;if(n===s.type||n===u.type||n===y.type){var m=e.payload.value,g=Array.isArray(m)?m.slice():Object.assign({},m),b=this.joinPathWithPropertyPath(e);a=r.setValue(a,b,g)}if(n===y.type){var F=r.getValue(a,e.payload.path+".model");a=r.setValue(a,""+e.payload.path,{model:F})}return n!==i.type&&n!==u.type||(a=r.setValue(a,e.payload.path+".status",e.payload.status)),n!==d.type&&n!==u.type||(a=r.setValue(a,e.payload.path+".errors",Object.assign({},e.payload.errors))),n!==p.type&&n!==u.type||(a=r.setValue(a,e.payload.path+".dirty",e.payload.dirty)),n===c.type&&(a=r.setValue(a,e.payload+".dirty",!0)),n===l.type&&(a=r.setValue(a,e.payload+".dirty",!1)),n===f.type&&(a=r.setValue(a,e.payload+".disabled",!0)),n===h.type&&(a=r.setValue(a,e.payload+".disabled",!1)),o(a,e)},t.prototype.joinPathWithPropertyPath=function(t){var e=t.payload,r=e.path+".model";return e.propertyPath&&(r+="."+e.propertyPath),r},t}();m.decorators=[{type:e.Injectable}];var g=function(){function t(t,e,r,o){this._actions$=t,this._store=e,this._formGroupDirective=r,this._cd=o,this.path=null,this.debounce=100,this.clearDestroy=!1,this._destroy$=new n.Subject,this._updating=!1}return t.prototype.ngOnInit=function(){var t=this;this._actions$.pipe(r.ofActionDispatched(y),a.filter((function(e){return e.payload.path===t.path})),a.takeUntil(this._destroy$)).subscribe((function(e){var r=e.payload.value;t.form.reset(r),t.updateFormStateWithRawValue(!0),t._cd.markForCheck()})),this.getStateStream(this.path+".model").subscribe((function(e){!t._updating&&e&&(t.form.patchValue(e),t._cd.markForCheck())})),this.getStateStream(this.path+".dirty").subscribe((function(e){t.form.dirty!==e&&"boolean"==typeof e&&(e?t.form.markAsDirty():t.form.markAsPristine(),t._cd.markForCheck())})),this._store.selectOnce((function(e){return r.getValue(e,t.path)})).subscribe((function(){t._store.dispatch([new s({path:t.path,value:t.form.getRawValue()}),new i({path:t.path,status:t.form.status}),new p({path:t.path,dirty:t.form.dirty})])})),this.getStateStream(this.path+".disabled").subscribe((function(e){t.form.disabled!==e&&"boolean"==typeof e&&(e?t.form.disable():t.form.enable(),t._cd.markForCheck())})),this._formGroupDirective.valueChanges.pipe(this.debounceChange()).subscribe((function(){t.updateFormStateWithRawValue()})),this._formGroupDirective.statusChanges.pipe(a.distinctUntilChanged(),this.debounceChange()).subscribe((function(e){t._store.dispatch(new i({status:e,path:t.path}))}))},t.prototype.updateFormStateWithRawValue=function(t){var e=this;if(!this._updating){var r=this._formGroupDirective.control.getRawValue(),o=[new s({path:this.path,value:r}),new p({path:this.path,dirty:this._formGroupDirective.dirty}),new d({path:this.path,errors:this._formGroupDirective.errors})];t&&o.push(new i({path:this.path,status:this._formGroupDirective.status})),this._updating=!0,this._store.dispatch(o).subscribe({error:function(){return e._updating=!1},complete:function(){return e._updating=!1}})}},t.prototype.ngOnDestroy=function(){this._destroy$.next(),this._destroy$.complete(),this.clearDestroy&&this._store.dispatch(new u({path:this.path,value:null,dirty:null,status:null,errors:null}))},t.prototype.debounceChange=function(){var t=this;return"change"!==this._formGroupDirective.control.updateOn||this.debounce<0?function(e){return e.pipe(a.takeUntil(t._destroy$))}:function(e){return e.pipe(a.debounceTime(t.debounce),a.takeUntil(t._destroy$))}},Object.defineProperty(t.prototype,"form",{get:function(){return this._formGroupDirective.form},enumerable:!1,configurable:!0}),t.prototype.getStateStream=function(t){return this._store.select((function(e){return r.getValue(e,t)})).pipe(a.takeUntil(this._destroy$))},t}();g.decorators=[{type:e.Directive,args:[{selector:"[ngxsForm]"}]}],g.ctorParameters=function(){return[{type:r.Actions},{type:r.Store},{type:o.FormGroupDirective},{type:e.ChangeDetectorRef}]},g.propDecorators={path:[{type:e.Input,args:["ngxsForm"]}],debounce:[{type:e.Input,args:["ngxsFormDebounce"]}],clearDestroy:[{type:e.Input,args:["ngxsFormClearOnDestroy"]}]};var b=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:r.NGXS_PLUGINS,useClass:m,multi:!0}]}},t}();b.decorators=[{type:e.NgModule,args:[{imports:[o.ReactiveFormsModule],declarations:[g],exports:[g]}]}],t.NgxsFormPlugin=m,t.NgxsFormPluginModule=b,t.ResetForm=y,t.SetFormDirty=c,t.SetFormDisabled=f,t.SetFormEnabled=h,t.SetFormPristine=l,t.UpdateForm=u,t.UpdateFormDirty=p,t.UpdateFormErrors=d,t.UpdateFormStatus=i,t.UpdateFormValue=s,t.Éµa=g,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngxs-form-plugin.umd.min.js.map