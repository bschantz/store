{"version":3,"file":"ngxs-logger-plugin.umd.js","sources":["../../../../packages/logger-plugin/src/internals.ts","../../../../packages/logger-plugin/src/action-logger.ts","../../../../packages/logger-plugin/src/log-writer.ts","../../../../packages/logger-plugin/src/symbols.ts","../../../../packages/logger-plugin/src/logger.plugin.ts","../../../../packages/logger-plugin/src/logger.module.ts"],"sourcesContent":["export const repeat = (str: string, times: number) => new Array(times + 1).join(str);\n\nexport const pad = (num: number, maxLength: number) =>\n  repeat('0', maxLength - num.toString().length) + num;\n\nexport function formatTime(time: Date) {\n  return (\n    pad(time.getHours(), 2) +\n    `:` +\n    pad(time.getMinutes(), 2) +\n    `:` +\n    pad(time.getSeconds(), 2) +\n    `.` +\n    pad(time.getMilliseconds(), 3)\n  );\n}\n","import { getActionTypeFromInstance, Store } from '@ngxs/store';\n\nimport { formatTime } from './internals';\nimport { LogWriter } from './log-writer';\n\nexport class ActionLogger {\n  constructor(private action: any, private store: Store, private logWriter: LogWriter) {}\n\n  dispatched(state: any) {\n    const actionName = getActionTypeFromInstance(this.action);\n    const formattedTime = formatTime(new Date());\n\n    const message = `action ${actionName} @ ${formattedTime}`;\n    this.logWriter.startGroup(message);\n\n    // print payload only if at least one property is supplied\n    if (this._hasPayload(this.action)) {\n      this.logWriter.logGrey('payload', { ...this.action });\n    }\n\n    this.logWriter.logGrey('prev state', state);\n  }\n\n  completed(nextState: any) {\n    this.logWriter.logGreen('next state', nextState);\n    this.logWriter.endGroup();\n  }\n\n  errored(error: any) {\n    this.logWriter.logRedish('next state after error', this.store.snapshot());\n    this.logWriter.logRedish('error', error);\n    this.logWriter.endGroup();\n  }\n\n  private _hasPayload(event: any) {\n    const nonEmptyProperties = this._getNonEmptyProperties(event);\n    return nonEmptyProperties.length > 0;\n  }\n\n  private _getNonEmptyProperties(event: any) {\n    const keys = Object.keys(event);\n    const values = keys.map(key => event[key]);\n    return values.filter(value => value !== undefined);\n  }\n}\n","import { NgxsLoggerPluginOptions } from './symbols';\nexport class LogWriter {\n  private logger: any;\n\n  constructor(private options: NgxsLoggerPluginOptions) {\n    this.options = this.options || <any>{};\n    this.logger = options.logger || console;\n  }\n\n  startGroup(message: string) {\n    const startGroupFn = this.options.collapsed\n      ? this.logger.groupCollapsed\n      : this.logger.group;\n    try {\n      startGroupFn.call(this.logger, message);\n    } catch (e) {\n      console.log(message);\n    }\n  }\n\n  endGroup() {\n    try {\n      this.logger.groupEnd();\n    } catch (e) {\n      this.logger.log('—— log end ——');\n    }\n  }\n\n  logGrey(title: string, payload: any) {\n    const greyStyle = 'color: #9E9E9E; font-weight: bold';\n    this.log(title, greyStyle, payload);\n  }\n\n  logGreen(title: string, payload: any) {\n    const greenStyle = 'color: #4CAF50; font-weight: bold';\n    this.log(title, greenStyle, payload);\n  }\n\n  logRedish(title: string, payload: any) {\n    const redishStyle = 'color: #FD8182; font-weight: bold';\n    this.log(title, redishStyle, payload);\n  }\n\n  log(title: string, color: string, payload: any) {\n    if (this.isIE()) {\n      this.logger.log(title, payload);\n    } else {\n      this.logger.log('%c ' + title, color, payload);\n    }\n  }\n\n  isIE(): boolean {\n    const ua =\n      typeof window !== 'undefined' && window.navigator.userAgent\n        ? window.navigator.userAgent\n        : '';\n    let msIE = false;\n    const oldIE = ua.indexOf('MSIE ');\n    const newIE = ua.indexOf('Trident/');\n    if (oldIE > -1 || newIE > -1) {\n      msIE = true;\n    }\n    return msIE;\n  }\n}\n","import { InjectionToken } from '@angular/core';\n\nexport interface NgxsLoggerPluginOptions {\n  /** Auto expand logged actions  */\n  collapsed?: boolean;\n\n  /** Provide alternate console.log implementation */\n  logger?: any;\n\n  /** Disable the logger. Useful for prod mode. */\n  disabled?: boolean;\n\n  /** Predicate for actions to be the logged. Takes action and state snapshot as parameters */\n  filter?: (action: any, state: any) => boolean;\n}\n\nexport const NGXS_LOGGER_PLUGIN_OPTIONS = new InjectionToken('NGXS_LOGGER_PLUGIN_OPTIONS');\n","import { Inject, Injectable, Injector } from '@angular/core';\nimport { NgxsNextPluginFn, NgxsPlugin, Store } from '@ngxs/store';\nimport { catchError, tap } from 'rxjs/operators';\nimport { ActionLogger } from './action-logger';\nimport { LogWriter } from './log-writer';\nimport { NgxsLoggerPluginOptions, NGXS_LOGGER_PLUGIN_OPTIONS } from './symbols';\n\n@Injectable()\nexport class NgxsLoggerPlugin implements NgxsPlugin {\n  private _store: Store;\n  private _logWriter: LogWriter;\n\n  constructor(\n    @Inject(NGXS_LOGGER_PLUGIN_OPTIONS) private _options: NgxsLoggerPluginOptions,\n    private _injector: Injector\n  ) {}\n\n  handle(state: any, event: any, next: NgxsNextPluginFn) {\n    if (this._options.disabled || !this._options.filter!(event, state)) {\n      return next(state, event);\n    }\n\n    this._logWriter = this._logWriter || new LogWriter(this._options);\n    // Retrieve lazily to avoid cyclic dependency exception\n    this._store = this._store || this._injector.get<Store>(Store);\n\n    const actionLogger = new ActionLogger(event, this._store, this._logWriter);\n\n    actionLogger.dispatched(state);\n\n    return next(state, event).pipe(\n      tap(nextState => {\n        actionLogger.completed(nextState);\n      }),\n      catchError(error => {\n        actionLogger.errored(error);\n        throw error;\n      })\n    );\n  }\n}\n","import { InjectionToken, ModuleWithProviders, NgModule } from '@angular/core';\nimport { NGXS_PLUGINS } from '@ngxs/store';\nimport { NgxsLoggerPlugin } from './logger.plugin';\nimport { NgxsLoggerPluginOptions, NGXS_LOGGER_PLUGIN_OPTIONS } from './symbols';\n\nexport const USER_OPTIONS = new InjectionToken('LOGGER_USER_OPTIONS');\n\nexport function loggerOptionsFactory(options: NgxsLoggerPluginOptions) {\n  const defaultLoggerOptions: NgxsLoggerPluginOptions = {\n    logger: console,\n    collapsed: false,\n    disabled: false,\n    filter: () => true\n  };\n\n  return {\n    ...defaultLoggerOptions,\n    ...options\n  };\n}\n\n@NgModule()\nexport class NgxsLoggerPluginModule {\n  static forRoot(\n    options?: NgxsLoggerPluginOptions\n  ): ModuleWithProviders<NgxsLoggerPluginModule> {\n    return {\n      ngModule: NgxsLoggerPluginModule,\n      providers: [\n        {\n          provide: NGXS_PLUGINS,\n          useClass: NgxsLoggerPlugin,\n          multi: true\n        },\n        {\n          provide: USER_OPTIONS,\n          useValue: options\n        },\n        {\n          provide: NGXS_LOGGER_PLUGIN_OPTIONS,\n          useFactory: loggerOptionsFactory,\n          deps: [USER_OPTIONS]\n        }\n      ]\n    };\n  }\n}\n"],"names":["getActionTypeFromInstance","InjectionToken","Store","tap","catchError","Injectable","Inject","Injector","NGXS_PLUGINS","NgModule"],"mappings":"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"}